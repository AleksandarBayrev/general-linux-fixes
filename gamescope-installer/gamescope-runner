#!/bin/bash

GS_ARGS=()
COMMAND=()
FOUND_SEPARATOR=false

# 1. Check if the script was called with zero arguments
if [ $# -eq 0 ]; then
    echo "No arguments provided. Showing gamescope help:"
    gamescope --help
    exit 0
fi

# 2. Parse arguments
for arg in "$@"; do
  if [[ "$arg" == "--" && "$FOUND_SEPARATOR" == false ]]; then
    FOUND_SEPARATOR=true
    continue
  fi

  if [[ "$FOUND_SEPARATOR" == true ]]; then
    COMMAND+=("$arg")
  else
    GS_ARGS+=("$arg")
  fi
done

# 3. Execution
gamescope "${GS_ARGS[@]}" -- "${COMMAND[@]}" &
GS_PID=$!

wait $GS_PID

# 4. Clean up
killall -9 -u $(whoami) gamescopereaper gamescope 2>/dev/null

exit 0